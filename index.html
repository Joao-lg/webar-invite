<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebAR</title>
  <style>
    /* Include the CSS code here */
    .webar {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      z-index: 200;
      width: 240px; 
      height: 240px; 
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
      border-radius: 20px;
      overflow: hidden;
      padding: 20px;
      background-color: white;
    }

    .webar button {
      padding: 0;
      border: none;
      width: auto;
      margin: 0;
      position: absolute;
      right: 4px;
      top: 0px;
      transform: rotate(45deg);
      cursor: pointer;
      z-index: 10;
    }

    .webar button:focus {
      box-shadow: none;
    }

    .webar > div {
      width: 100%;
      height: 100%;
    }

    .webar > div > canvas {
      width: 100% !important;
      height: 100% !important;
    }

    model-viewer {
      display: none;
    }
  </style>
  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.1.1/model-viewer.min.js"></script>
</head>
<body>
  <div id="app">
    <div id="webar-mobile" >
      <model-viewer id="model-viewer"
        ar
        magic-leap
        ar-status="not-presenting"
        autoplay
        bounds="tight"
        enable-pan
        environment-image="neutral"
        shadow-intensity="1"
        ar-modes="scene-viewer quick-look webxr"
        quick-look-browsers="safari chrome firefox"
        scale="0.05 0.05 0.05">
      </model-viewer>
    </div>
  </div>
  <script>
    // Include the JavaScript code here
    document.addEventListener('DOMContentLoaded', function() {
      const app = {
        device: null,
        firstActivate: false,
        object: {}, // Replace with your object data
        updateWebxr: false,
        get sourceUrl() {
          return "https://pixel-dev.fra1.digitaloceanspaces.com/users/5/public/3d/1706118144.glb";
        },
        get sourceUrlIos() {
          return "https://pixel-dev.fra1.digitaloceanspaces.com/users/5/public/3d/1706118144.glb";
        },
        get animationName() {
          return this.object?.file?.animationName || "";
        },
        init() {
            document.getElementById('webar-mobile').style.display = 'block';
            const modelViewer = document.getElementById('model-viewer');
            modelViewer.setAttribute('src', this.sourceUrl);
            modelViewer.setAttribute('ios-src', this.sourceUrlIos);
            modelViewer.setAttribute('animation-name', this.animationName);
            this.activatedAR()
        },
        activatedAR() {
          const mv = document.getElementById('model-viewer');
          console.log(mv, mv.canActivateAR)
          if (mv && mv.canActivateAR) {
            if (!this.firstActivate) {
              this.firstActivate = true;
              setTimeout(() => {
                mv.activateAR();
              }, 240);
            } else {
              mv.activateAR();
            }
          } else {
            console.error("current platform doesn't support AR");
          }
        },
      };
      app.init();
    });
    console.log('init')
  </script>
</body>
</html>
